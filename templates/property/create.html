{% extends "base.html" %}

{% block content %}
<h2>Добавить объявление</h2>
<form method="post" id="property-form">
    {% csrf_token %}
    {{ form.as_p }}
    
    <div id="map" style="width: 100%; height: 400px; margin: 20px 0;"></div>
    
    <button type="submit">Сохранить</button>
</form>

<script src="https://api-maps.yandex.ru/2.1/?apikey={{ YANDEX_MAPS_API_KEY }}&lang=ru_RU"></script>
<script>
ymaps.ready(function() {
    const map = new ymaps.Map('map', {
        center: [55.75, 37.61],
        zoom: 10
    });
    
    const addressInput = document.getElementById('address-input');
    
    addressInput.addEventListener('change', function() {
        ymaps.geocode(this.value).then(function(res) {
            const firstGeoObject = res.geoObjects.get(0);
            if (firstGeoObject) {
                map.geoObjects.removeAll();
                map.geoObjects.add(firstGeoObject);
                map.setCenter(firstGeoObject.geometry.getCoordinates());
                
                // Автоматически заполняем скрытые поля координат
                const coords = firstGeoObject.geometry.getCoordinates();
                document.getElementById('id_latitude').value = coords[0];
                document.getElementById('id_longitude').value = coords[1];
            }
        });
    });
});
</script>
{% endblock %}